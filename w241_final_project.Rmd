---
title: "w241 Final Project"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
```

```{r}
all <- read.csv("resp_improve.csv", header = TRUE, sep = ",")
tail(all)
```

```{r}
filtered <- filter(
  all,
  wfh != "",
  wfh != "not_working",
  duration_focus_pre != "",
  duration_focus_post_2 != ""
)
nrow(all)
nrow(filtered)
```

```{r}
df <- data.frame(
  wfh = filtered$wfh,
  duration_focus_pre = filtered$duration_focus_pre,
  duration_focus_post = filtered$duration_focus_post_2
)
df
```

```{r}
control <- filter(df, wfh != "yes_post")
nrow(control)

treat <- filter(df, wfh == "yes_post")
nrow(treat)
```

```{r}
control
treat
```

```{r}
summary(control)
barplot(table(control$duration_focus_pre))
barplot(table(control$duration_focus_post))
```

```{r}
summary(treat)
barplot(table(treat$duration_focus_pre))
barplot(table(treat$duration_focus_post))
```

```{r}
library(data.table)
dt<-data.table(filtered)
dt[,treatment := 1*(wfh=='yes_post') + 0*(wfh=='no' | wfh=='yes_pre')]
dt[dt$wfh=='not_working',treatment :=NA]
table(dt$treatment,dt$wfh)
dt[,table(wfh)]

#covariate balance check
dt[,fisher.test(treatment,job_category)] #no significant association with job_category
dt$year<-as.numeric(levels(dt$year_of_birth))[dt$year_of_birth]
dt[,age := 2020-year]
dt[,t.test(age~treatment)] # no significant difference in age by treatment
dt[,fisher.test(treatment,sex)] # no significant association with sex
dt[,fisher.test(treatment,gender)] # no significant association with gender
dt[,fisher.test(treatment,race)] #no significant association with race
```
